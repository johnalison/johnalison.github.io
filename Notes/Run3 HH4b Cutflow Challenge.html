<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2026-03-01 Sun 04:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Run3 HH4b Cutflow Challenge</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/style.css'/>
<script src='/fix-tables.js' defer='defer'></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Run3 HH4b Cutflow Challenge</h1>



<div id="outline-container-org7d7abc0" class="outline-2">
<h2 id="org7d7abc0">Mail from Marina</h2>
<div class="outline-text-2" id="text-org7d7abc0">
<p>
Please find below the (lxplus) path to the 2022EE NTuples:
</p>

<p>
<i>afs</i>[cern.ch/user/m/mkolosov/public/forJohn/data<sub>2022</sub><sub>postEE</sub><sub>0</sub><sub>tree.root</sub>](<a href="http://cern.ch/user/m/mkolosov/public/forJohn/data_2022_postEE_0_tree.root">http://cern.ch/user/m/mkolosov/public/forJohn/data_2022_postEE_0_tree.root</a>)
</p>

<p>
To get the events in the 4b(&gt;=3bT) control region you'd need to apply the following selections:
</p>
<ul class="org-ul">
<li>(avgbdisc<sub>twoldgbdiscjets</sub> &gt; 0.65)</li>
<li>(dHH<sub>HH</sub><sub>regmass</sub> &gt; 350)</li>
</ul>

<p>
And then apply the 4b(&gt;=3bT) mask:
</p>

<p>
MASK<sub>4b</sub>: (dHH<sub>NbtagM</sub> <code>= 4) &amp; (dHH_NbtagT &gt;</code> 3)
</p>

<p>
HM: np.stack([dHH<sub>H1</sub><sub>regmass</sub>, dHH<sub>H2</sub><sub>regmass</sub>], axis=1)
AR<sub>center</sub>: '125, 120' 
AR<sub>dHM</sub>: np.sum( (HM - AR<sub>center</sub>)*2, axis=1 )*0.5
</p>

<p>
and the CR mask:
ACR: (AR<sub>dHM</sub> &gt;= 30) &amp; (AR<sub>dHM</sub> &lt; 55)
</p>
</div>
</div>


<div id="outline-container-org9ef459e" class="outline-2">
<h2 id="org9ef459e">Logs</h2>
<div class="outline-text-2" id="text-org9ef459e">
</div>
<div id="outline-container-orgc0d8939" class="outline-3">
<h3 id="orgc0d8939">[BROKEN LINK: E58C60ED-9000-4234-835E-F6E00D672FCE]</h3>
<div class="outline-text-3" id="text-orgc0d8939">
<ul class="org-ul">
<li>on <b>cmslpc335</b></li>
</ul>
<ul class="org-ul">
<li>Remaking B from nano
<ul class="org-ul">
<li><code>python runner.py -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b.yml -y 2022_preEE -d data -e B  -op skimmer/metadata/ -o picoaod_datasets_data_2022_preEEB_debug_v2.yml -m metadata/datasets_HH4b_Run3.yml --condor</code></li>
<li><code>python3 metadata/merge_yaml_datasets.py  -m metadata/datasets_HH4b_Run3.yml  -o metadata/datasets_HH4b_Run3_merged_debug_v2.yml  -f skimmer/metadata/picoaod_datasets_data_2022_preEEB_debug_v2.yml</code></li>
<li><code>python runner.py  -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b_fourTag.yml -y 2022_preEE  -d data -op skimmer/metadata/ -o picoaod_datasets_fourTag_data_Run3_vDebug_v2.yml -m metadata/datasets_HH4b_Run3_merged_debug_v2.yml --condor</code></li>
</ul></li>
<li>Events not in four b skimmmer&#x2026; problem was eta requirement in lowPt skimming</li>
<li>Fixed.</li>
<li>Now re-running skims on C and D over all</li>
<li>Re-doing the four-tag skim</li>
<li>Agreement now: 
<ul class="org-ul">
<li><code>Total number of missing events: 317 (1.3% of total events)</code></li>
<li><code>Total number of extra events: 5986 (19.87% of total events)</code></li>
</ul></li>
<li>Going to reskim all Run3
<ul class="org-ul">
<li>Submitted 2022<sub>EE</sub> : <code>source  skim2022_EE.sh</code></li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orgeee83cd" class="outline-3">
<h3 id="orgeee83cd"><a href="../Journal/2025/04-April/22-April-2025-Tuesday.html#ID-C0D7FE4C-EBDC-405E-8288-CF6D816B6E5B">22 April 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-orgeee83cd">
<ul class="org-ul">
<li><b>cmslpc319</b></li>
<li>Skim works when running on condor !</li>
<li>All events are there in the skim now!</li>
<li>Will re run C and D before redoing the cutflow</li>
<li><code>python runner.py -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b.yml -y 2022_preEE -d data -e C  -op skimmer/metadata/ -o picoaod_datasets_data_2022_preEEC_debug.yml -m metadata/datasets_HH4b_Run3.yml --condor</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgacd2c0b" class="outline-3">
<h3 id="orgacd2c0b"><a href="../Journal/2025/04-April/21-April-2025-Monday.html#ID-F5132293-BEE6-4BF5-91B3-F51811AE2343">21 April 2025 Monday</a></h3>
<div class="outline-text-3" id="text-orgacd2c0b">
<p>
<a href="Run-3 4b skims.html#ID-1624929A-3B77-46EB-8AA5-8F5DB0C2EC3E">Run-3 4b skims</a>
</p>
<ul class="org-ul">
<li>checking which file has the run I care about</li>
<li><code>dasgoclient --query</code>"run dataset=/JetMET/Run2022C-22Sep2023-v1/NANOAOD"=</li>
<li><code>&gt; python runner.py -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b.yml -y 2022_preEE -d data -e B  -op skimmer/metadata/ -o picoaod_datasets_data_2022_preEE_debug.yml -m metadata/datasets_HH4b_Run3.yml --condor</code></li>
<li>Running on <b>cmslpc332</b></li>
<li>Adding debugging output</li>
</ul>
</div>
</div>

<div id="outline-container-orgc5f91b3" class="outline-3">
<h3 id="orgc5f91b3"><a href="../Journal/2025/04-April/15-April-2025-Tuesday.html#ID-DCDF29BB-C023-4251-9CFD-BC045BD652BE">15 April 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-orgc5f91b3">
<ul class="org-ul">
<li>Impletented the Run3 case when dhh &lt; 30 GeV</li>
<li>Remade pkl inputs</li>
<li>Now better agreement! 
<ul class="org-ul">
<li>Before:
<code>Total number of missing events: 11690 (47.79% of total events)</code>
<code>Total number of extra events: 4918 (27.81% of total events)</code></li>
<li>Now:
<code>Total number of missing events: 8426 (34.45% of total events)</code>
<code>Total number of extra events: 2706 (14.44% of total events)</code></li>
</ul></li>
<li>Eg: `Run 355872: 99 missing events
<code>First 5 missing events: [228793492, 993131619, 994362241, 994277091, 1003079747, 1007831198, 1141642728, 1145575379, 1145596930, 1086081738]</code></li>
</ul>
</div>
</div>


<div id="outline-container-orgbef2ecd" class="outline-3">
<h3 id="orgbef2ecd"><a href="../Journal/2025/04-April/14-April-2025-Monday.html#ID-2647C335-3961-4BF6-AAB0-3F90FF5850CB">14 April 2025 Monday</a></h3>
<div class="outline-text-3" id="text-orgbef2ecd">
<ul class="org-ul">
<li>Yes, we follow the method used in HIG-20-005 ( [<a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350</a>](<a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350</a>) )  in which : 
if the difference of the minimum and second minimum distance from the diagonal is less than 30, we choose the pair that has the maximum H1 pT in the 4-jet center-of-mass frame.</li>
<li>Implementing mhh &lt; 30 check</li>
<li><code>python -m unittest analysis.tests.quadjet_test.quadJetTestCase</code></li>
</ul>
</div>
</div>

<div id="outline-container-org548618a" class="outline-3">
<h3 id="org548618a"><a href="../Journal/2025/04-April/11-April-2025-Friday.html#ID-CDAA4234-8BE6-4F9D-A4E5-B5B40371E417">11 April 2025 Friday</a></h3>
<div class="outline-text-3" id="text-org548618a">
<ul class="org-ul">
<li>finding events&#x2026;</li>
<li>Most (70%) missing the skimmer.</li>
<li>lxplus down&#x2026;not down just slow</li>
<li>Finding problem events&#x2026; printing out the jet four vectors</li>
</ul>
</div>
</div>

<div id="outline-container-orgd585411" class="outline-3">
<h3 id="orgd585411"><a href="../Journal/2025/04-April/09-April-2025-Wednesday.html#ID-BF814272-2DD0-4BFF-A442-50DF8F2F24CE">9 April 2025 Wednesday</a></h3>
<div class="outline-text-3" id="text-orgd585411">
<ul class="org-ul">
<li>adding <code>event</code> and <code>run</code> to the skim</li>
<li>50% of events different !</li>
<li>run <code>355872</code>: 94 missing events
First 10 missing events: `[228793492, 993131619, 994277091, 995618735, 1003079747, 1145575379, 917646697, 1086081738, 276519899, 321185192 &#x2026; 
<ul class="org-ul">
<li><code>python runner.py   -o synthetic_data_Run3_v8_debug_seedXXX.coffea -d data  -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v8.yml</code></li>
</ul></li>
<li>Errors with running in cofffea &#x2026; debugging (in Cursor! )</li>
</ul>
</div>
</div>

<div id="outline-container-org3dad5f3" class="outline-3">
<h3 id="org3dad5f3"><a href="../Journal/2025/04-April/08-April-2025-Tuesday.html#ID-F51A4EF9-20C3-40CB-BE28-D8CFB357131C">8 April 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-org3dad5f3">
<ul class="org-ul">
<li>made python script to read Marinas file (Cursor !!!)
<ul class="org-ul">
<li>= /Users/johnda/CMSWork/hh4b/coffea4bees/python/analysis &gt; py process<sub>event</sub><sub>numbers.py</sub> =</li>
</ul></li>
<li>re-Making my pkl file: 
<ul class="org-ul">
<li><code>python runner.py  -o synthetic_data_Run3_v8_debug_seedXXX.coffea -d data synthetic_data -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v8.yml</code></li>
</ul></li>
<li>Marina's file has all the data events&#x2026; How to get only the 4b CR events ? pinged her</li>
<li>Got instructions for CR events</li>
<li>skipping the input file for 4Tag events</li>
<li>fighting with trying to filter the 4b events</li>
</ul>
</div>
</div>

<div id="outline-container-org023be8d" class="outline-3">
<h3 id="org023be8d"><a href="../Journal/2025/03-March/31-March-2025-Monday.html#ID-EADAD6C4-B580-826C-56E7-4976DF7FAAA7">31 March 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org023be8d">
<ul class="org-ul">
<li>Marina's cutflow is off
<ul class="org-ul">
<li>requested events/run list</li>
<li>[&gt;&gt;] Compare Events</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-org50aefdf" class="outline-3">
<h3 id="org50aefdf"><a href="../Journal/2025/03-March/17-March-2025-Monday.html#ID-06DD1AA5-DB7E-2E5D-E879-BF970A34A274">17 March 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org50aefdf">
<ul class="org-ul">
<li>added pt<sub>raw</sub> to debug output</li>
<li>remade pkl file for Marina&#x2026; sent</li>
</ul>
</div>
</div>

<div id="outline-container-orgf6745fd" class="outline-3">
<h3 id="orgf6745fd"><a href="../Journal/2025/03-March/14-March-2025-Friday.html#ID-7F40DCD3-868F-D0E9-37DF-A1D8CC4F8241">14 March 2025 Friday</a></h3>
<div class="outline-text-3" id="text-orgf6745fd">
<ul class="org-ul">
<li>Fixed Cutflow for Marina</li>
<li>Add was only including one data Era</li>
<li>Add other eras</li>
<li>Add other Pt corrections</li>
<li>sent</li>
</ul>
</div>
</div>

<div id="outline-container-org7f53386" class="outline-3">
<h3 id="org7f53386"><a href="../Journal/2025/03-March/13-March-2025-Thursday.html#ID-8C72BE12-6828-6F0A-FB49-CA5817659A04">13 March 2025 Thursday</a></h3>
<div class="outline-text-3" id="text-org7f53386">
<ul class="org-ul">
<li>Implementing Run3 Selection</li>
<li>Working cutflow &#x2026; got unit test working</li>
<li>Adding dhh min</li>
<li>Synch Higgs Candidate Selection</li>
<li>Making Cut flow for Marina:
<ul class="org-ul">
<li><code>python runner.py  -o synthetic_data_Run3_v8_debug_seedXXX.coffea -d data synthetic_data -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v8.yml</code></li>
</ul></li>
<li>Make output files for Marina
<ul class="org-ul">
<li><code>python analysis/debugRun3SyntheticData.py output/synthetic_dataset_analyze_all/synthetic_data_Run3_v8_debug_seedXXX.coffea</code></li>
</ul></li>
<li>Sent cutflow to Marina</li>
<li>Running plots for data vs synthetic</li>
</ul>
</div>
</div>

<div id="outline-container-orgafcd536" class="outline-3">
<h3 id="orgafcd536"><a href="../Journal/2025/03-March/12-March-2025-Wednesday.html#ID-2FBDF0DC-6722-A72F-18D5-1ED28CEAD64E">12 March 2025 Wednesday</a></h3>
<div class="outline-text-3" id="text-orgafcd536">
<ul class="org-ul">
<li>Implementing Run3 selection</li>
<li>From Marina: 
<ul class="org-ul">
<li>Code: <a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads</a></li>
<li>Config: <a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/run/configs/2021/main/run3_2021_0L_PNet_MinDiag_Jets_4j35_2bj30_dHHjw30.yaml?ref_type=heads">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/run/configs/2021/main/run3_2021_0L_PNet_MinDiag_Jets_4j35_2bj30_dHHjw30.yaml?ref_type=heads</a></li>
</ul></li>
<li>Synch Lepton Definition</li>
<li>[&gt;&gt;] Synch Higgs Candidate Selection</li>
<li>Synched Electrons</li>
<li>Synched Muons:</li>
<li>Testing with 
<ul class="org-ul">
<li><code>time python runner.py -t -o synthetic_data_Run3_2022_preEE.coffea -d data -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v6.yml</code></li>
</ul></li>
<li>Trying test case
<ul class="org-ul">
<li><code>python -m unittest analysis.tests.quadjet_test.quadJetTestCase</code></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org780d7e0" class="outline-3">
<h3 id="org780d7e0"><a href="../Journal/2025/01-January/07-January-2025-Tuesday.html#ID-55377750-457D-42C3-96AC-AF2D46D57488">7 January 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-org780d7e0">
<ul class="org-ul">
<li>output event list for florida
<ul class="org-ul">
<li><code>python debug_HHRun3.py</code></li>
</ul></li>
<li>Outputting our preSelection event list
<ul class="org-ul">
<li><code>time python runner.py -o data_Run3_2022_EE.coffea -d data -p analysis/processors/processor_HH4b.py -y 2022_EE   -op hists -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v4.yml</code></li>
</ul></li>
<li>Ask Marina to compare unblinded inclusive 4b counts&#x2026; Maybe normalization is CR acceptance difference</li>
<li>Made our event numbers list</li>
<li><code>python analysis/debugRun3CutFlow.py  hists/data_Run3_2022_EE.coffea</code></li>
<li>Only missing ~1% of events</li>
<li>Some differences in jet and b-jet multiplicities</li>
</ul>
</div>
</div>


<div id="outline-container-org82414a2" class="outline-3">
<h3 id="org82414a2"><a href="../Journal/2025/01-January/06-January-2025-Monday.html#ID-7F78110C-C72D-4DA4-92F9-333174E49D26">6 January 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org82414a2">
<ul class="org-ul">
<li>Copied File from marina to 
<code>root://cmseos.fnal.gov//store/user/jda102/debugRun3HH/data_2022_postEE_0_tree.root</code></li>
<li>Chat GPT to write uproot program</li>
<li>Wrote out a pkl file with the events and lumis</li>
<li>Make pickle of events passing 4jets selection</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org0601035" class="outline-2">
<h2 id="org0601035">Follow-ups</h2>
</div>


<div id="outline-container-orga38c05e" class="outline-2">
<h2 id="orga38c05e">Links:</h2>
<div class="outline-text-2" id="text-orga38c05e">
<p>
202501061122
</p>
</div>
</div>
</div>
<div class="backlinks">
<h2>Backlinks</h2>
<ul>
  <li><a href="Run-3 4b skims.html">Run-3 4b skims</a></li>
  <li><a href="../Journal/2025/04-April/29-April-2025-Tuesday.html">29 April 2025 Tuesday</a></li>
  <li><a href="../Journal/2025/04-April/22-April-2025-Tuesday.html">22 April 2025 Tuesday</a></li>
  <li><a href="../Journal/2025/04-April/21-April-2025-Monday.html">21 April 2025 Monday</a></li>
  <li><a href="../Journal/2025/04-April/14-April-2025-Monday.html">14 April 2025 Monday</a></li>
  <li><a href="../Journal/2025/04-April/12-April-2025-Saturday.html">12 April 2025 Saturday</a></li>
  <li><a href="../Journal/2025/04-April/11-April-2025-Friday.html">11 April 2025 Friday</a></li>
  <li><a href="../Journal/2025/04-April/10-April-2025-Thursday.html">10 April 2025 Thursday</a></li>
  <li><a href="../Journal/2025/04-April/09-April-2025-Wednesday.html">09 April 2025 Wednesday</a></li>
  <li><a href="../Journal/2025/04-April/08-April-2025-Tuesday.html">08 April 2025 Tuesday</a></li>
  <li><a href="../Journal/2025/03-March/31-March-2025-Monday.html">31 March 2025 Monday</a></li>
  <li><a href="../Journal/2025/03-March/17-March-2025-Monday.html">17 March 2025 Monday</a></li>
  <li><a href="../Journal/2025/03-March/14-March-2025-Friday.html">14 March 2025 Friday</a></li>
  <li><a href="../Journal/2025/03-March/13-March-2025-Thursday.html">13 March 2025 Thursday</a></li>
  <li><a href="../Journal/2025/03-March/12-March-2025-Wednesday.html">12 March 2025 Wednesday</a></li>
  <li><a href="../Journal/2025/01-January/07-January-2025-Tuesday.html">07 January 2025 Tuesday</a></li>
  <li><a href="../Journal/2025/01-January/06-January-2025-Monday.html">06 January 2025 Monday</a></li>
</ul>
</div>
</body>
</html>
