<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2026-03-01 Sun 04:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Run3 HH4b Cutflow Challenge</title>
<meta name="generator" content="Org Mode" />
<link rel='stylesheet' type='text/css' href='/style.css'/>
<script src='/fix-tables.js' defer='defer'></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Run3 HH4b Cutflow Challenge</h1>


<div id="outline-container-orgf1bebc1" class="outline-2">
<h2 id="orgf1bebc1">Mail from Marina</h2>
<div class="outline-text-2" id="text-orgf1bebc1">
<p>
Please find below the (lxplus) path to the 2022EE NTuples:
</p>

<p>
<i>afs</i>[cern.ch/user/m/mkolosov/public/forJohn/data<sub>2022</sub><sub>postEE</sub><sub>0</sub><sub>tree.root</sub>](<a href="http://cern.ch/user/m/mkolosov/public/forJohn/data_2022_postEE_0_tree.root">http://cern.ch/user/m/mkolosov/public/forJohn/data_2022_postEE_0_tree.root</a>)
</p>

<p>
To get the events in the 4b(&gt;=3bT) control region you'd need to apply the following selections:
</p>
<ul class="org-ul">
<li>(avgbdisc<sub>twoldgbdiscjets</sub> &gt; 0.65)</li>
<li>(dHH<sub>HH</sub><sub>regmass</sub> &gt; 350)</li>
</ul>

<p>
And then apply the 4b(&gt;=3bT) mask:
</p>

<p>
MASK<sub>4b</sub>: (dHH<sub>NbtagM</sub> <code>= 4) &amp; (dHH_NbtagT &gt;</code> 3)
</p>

<p>
HM: np.stack([dHH<sub>H1</sub><sub>regmass</sub>, dHH<sub>H2</sub><sub>regmass</sub>], axis=1)
AR<sub>center</sub>: '125, 120' 
AR<sub>dHM</sub>: np.sum( (HM - AR<sub>center</sub>)**2, axis=1 )**0.5
</p>

<p>
and the CR mask:
ACR: (AR<sub>dHM</sub> &gt;= 30) &amp; (AR<sub>dHM</sub> &lt; 55)
</p>
</div>
</div>


<div id="outline-container-org65e33ec" class="outline-2">
<h2 id="org65e33ec">Logs</h2>
<div class="outline-text-2" id="text-org65e33ec">
</div>
<div id="outline-container-org39c0694" class="outline-3">
<h3 id="org39c0694"><a href="../Journal/2025/04-April/28-April-2025-Monday.html#ID-DBCEBFBC-6403-4273-BCAD-00198C126DDA">28 April 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org39c0694">
<ul class="org-ul">
<li>I think the cutflow problem could be due to the four tag skimmer.</li>
<li>merging: 
<ul class="org-ul">
<li><code>python3 metadata/merge_yaml_datasets.py  -m metadata/datasets_HH4b_Run3.yml  -o metadata/datasets_HH4b_Run3_merged_debug.yml  -f skimmer/metadata/picoaod_datasets_data_2022_preEE*_debug.yml</code></li>
</ul></li>
<li>Running with out 4b skim on <b>cmslpc331</b>
<ul class="org-ul">
<li><code>python runner.py -o data_Run3_vDebug_new.coffea -d data -p analysis/processors/processor_HH4b.py -y 2022_preEE -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_merged_debug.yml --condor</code></li>
</ul></li>
<li>taking too long&#x2026;. Will do 4b skim
<ul class="org-ul">
<li><code>python runner.py  -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b_fourTag.yml -y 2022_preEE  -d data -op skimmer/metadata/ -o picoaod_datasets_fourTag_data_Run3_vDebug.yml -m metadata/datasets_HH4b_Run3_merged_debug.yml --condor</code></li>
</ul></li>
<li>Merging
<ul class="org-ul">
<li><code>python metadata/merge_yaml_datasets.py -m metadata/datasets_HH4b_Run3.yml -o metadata/datasets_HH4b_Run3_fourTag_vDebug.yml -f skimmer/metadata/picoaod_datasets_fourTag_data_Run3_vDebug.yml</code></li>
</ul></li>
<li>Running
<ul class="org-ul">
<li>=python runner.py -o data<sub>Run3</sub><sub>vDebug</sub><sub>new.coffea</sub> -d data -p analysis/processors/processor<sub>HH4b.py</sub> -y 2022<sub>preEE</sub> -op output/synthetic<sub>dataset</sub><sub>analyze</sub><sub>all</sub> -c analysis/metadata/HH4b<sub>run</sub><sub>fastTopReco.yml</sub> -m metadata/datasets<sub>HH4b</sub><sub>Run3</sub><sub>fourTag</sub><sub>vDebug.yml</sub> =</li>
</ul></li>
<li>See way too few events in debug&#x2026; needed to update the debug mask&#x2026; Rerunning</li>
<li>Agreement now
<ul class="org-ul">
<li><code>Total number of missing events: 1119 (4.58% of total events)</code></li>
<li><code>Total number of extra events: 5778 (19.84% of total events)</code></li>
</ul></li>
<li>Most events dont make the skim&#x2026;</li>
<li>Reskimming  on (<b>cmslpc324</b>) with debug info for correct numbers:
<ul class="org-ul">
<li><code>python runner.py  -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b_fourTag.yml -y 2022_preEE  -d data -op skimmer/metadata/ -o picoaod_datasets_fourTag_data_Run3_vDebug.yml -m metadata/datasets_HH4b_Run3_merged_debug.yml --condor</code></li>
</ul></li>
<li>Jet eta cut is different!  2.4 (US) vs 2.5 (Marina)</li>
<li>Reskimming with 2.5 cut
<ul class="org-ul">
<li><code>Total number of missing events: 580 (2.37% of total events)</code></li>
</ul></li>
<li>Added abs(delta<sub>dhh</sub>)</li>
<li>Remaking the skims with the new eta cut
<ul class="org-ul">
<li>Ran B, C and D</li>
<li><code>python runner.py -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b.yml -y 2022_preEE -d data -e B  -op skimmer/metadata/ -o picoaod_datasets_data_2022_preEE_debug.yml -m metadata/datasets_HH4b_Run3.yml --condor</code></li>
</ul></li>
<li>Merged .. Remade 4b&#x2026; (Not clear where the events are going&#x2026;they appear as fourTag in the first skim)</li>
<li>Hmmm back to 5% &#x2026;</li>
</ul>
</div>
</div>



<div id="outline-container-org6b80c56" class="outline-3">
<h3 id="org6b80c56"><a href="../Journal/2025/04-April/22-April-2025-Tuesday.html#ID-C0D7FE4C-EBDC-405E-8288-CF6D816B6E5B">22 April 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-org6b80c56">
<ul class="org-ul">
<li><b><b>cmslpc319</b></b></li>
<li>Skim works when running on condor !</li>
<li>All events are there in the skim now!</li>
<li>Will re run C and D before redoing the cutflow</li>
<li><code>python runner.py -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b.yml -y 2022_preEE -d data -e C  -op skimmer/metadata/ -o picoaod_datasets_data_2022_preEEC_debug.yml -m metadata/datasets_HH4b_Run3.yml --condor</code></li>
</ul>
</div>
</div>

<div id="outline-container-org220e276" class="outline-3">
<h3 id="org220e276"><a href="../Journal/2025/04-April/21-April-2025-Monday.html#ID-F5132293-BEE6-4BF5-91B3-F51811AE2343">21 April 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org220e276">
<p>
<a href="Run-3 4b skims.html#ID-1624929A-3B77-46EB-8AA5-8F5DB0C2EC3E">Run-3 4b skims</a>
</p>
<ul class="org-ul">
<li>checking which file has the run I care about</li>
<li><code>dasgoclient --query</code>"run dataset=/JetMET/Run2022C-22Sep2023-v1/NANOAOD"=</li>
<li><code>&gt; python runner.py -s -p skimmer/processor/skimmer_4b.py -c skimmer/metadata/HH4b.yml -y 2022_preEE -d data -e B  -op skimmer/metadata/ -o picoaod_datasets_data_2022_preEE_debug.yml -m metadata/datasets_HH4b_Run3.yml --condor</code></li>
<li>Running on <b><b>cmslpc332</b></b></li>
<li>Adding debugging output</li>
</ul>
</div>
</div>

<div id="outline-container-orga9e6283" class="outline-3">
<h3 id="orga9e6283"><a href="../Journal/2025/04-April/15-April-2025-Tuesday.html#ID-DCDF29BB-C023-4251-9CFD-BC045BD652BE">15 April 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-orga9e6283">
<ul class="org-ul">
<li>Impletented the Run3 case when dhh &lt; 30 GeV</li>
<li>Remade pkl inputs</li>
<li>Now better agreement! 
<ul class="org-ul">
<li>Before:
<code>Total number of missing events: 11690 (47.79% of total events)</code>
<code>Total number of extra events: 4918 (27.81% of total events)</code></li>
<li>Now:
<code>Total number of missing events: 8426 (34.45% of total events)</code>
<code>Total number of extra events: 2706 (14.44% of total events)</code></li>
</ul></li>
<li>Eg: <code>Run 355872: 99 missing events
  =First 5 missing events: [228793492, 993131619, 994362241, 994277091, 1003079747, 1007831198, 1141642728, 1145575379, 1145596930, 1086081738]</code></li>
</ul>
</div>
</div>


<div id="outline-container-org920135c" class="outline-3">
<h3 id="org920135c"><a href="../Journal/2025/04-April/14-April-2025-Monday.html#ID-2647C335-3961-4BF6-AAB0-3F90FF5850CB">14 April 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org920135c">
<ul class="org-ul">
<li>Yes, we follow the method used in HIG-20-005 ( [<a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350</a>](<a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads#L3350</a>) )  in which : 
if the difference of the minimum and second minimum distance from the diagonal is less than 30, we choose the pair that has the maximum H1 pT in the 4-jet center-of-mass frame.</li>
<li>Implementing mhh &lt; 30 check</li>
<li><code>python -m unittest analysis.tests.quadjet_test.quadJetTestCase</code></li>
</ul>
</div>
</div>

<div id="outline-container-orga7134aa" class="outline-3">
<h3 id="orga7134aa"><a href="../Journal/2025/04-April/11-April-2025-Friday.html#ID-CDAA4234-8BE6-4F9D-A4E5-B5B40371E417">11 April 2025 Friday</a></h3>
<div class="outline-text-3" id="text-orga7134aa">
<ul class="org-ul">
<li>finding events&#x2026;</li>
<li>Most (70%) missing the skimmer.</li>
<li>lxplus down&#x2026;not down just slow</li>
<li>Finding problem events&#x2026; printing out the jet four vectors</li>
</ul>
</div>
</div>

<div id="outline-container-org9398602" class="outline-3">
<h3 id="org9398602"><a href="../Journal/2025/04-April/09-April-2025-Wednesday.html#ID-BF814272-2DD0-4BFF-A442-50DF8F2F24CE">9 April 2025 Wednesday</a></h3>
<div class="outline-text-3" id="text-org9398602">
<ul class="org-ul">
<li>adding <code>event</code> and <code>run</code> to the skim</li>
<li>50% of events different !</li>
<li>run <code>355872</code>: 94 missing events
First 10 missing events: =[228793492, 993131619, 994277091, 995618735, 1003079747, 1145575379, 917646697, 1086081738, 276519899, 321185192 &#x2026; 
<ul class="org-ul">
<li><code>python runner.py   -o synthetic_data_Run3_v8_debug_seedXXX.coffea -d data  -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v8.yml</code></li>
</ul></li>
<li>Errors with running in cofffea &#x2026; debugging (in Cursor! )</li>
</ul>
</div>
</div>

<div id="outline-container-org55d1d79" class="outline-3">
<h3 id="org55d1d79"><a href="../Journal/2025/04-April/08-April-2025-Tuesday.html#ID-F51A4EF9-20C3-40CB-BE28-D8CFB357131C">8 April 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-org55d1d79">
<ul class="org-ul">
<li>made python script to read Marinas file (Cursor !!!)
<ul class="org-ul">
<li>= /Users/johnda/CMSWork/hh4b/coffea4bees/python/analysis &gt; py process<sub>event</sub><sub>numbers.py</sub> =</li>
</ul></li>
<li>re-Making my pkl file: 
<ul class="org-ul">
<li><code>python runner.py  -o synthetic_data_Run3_v8_debug_seedXXX.coffea -d data synthetic_data -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v8.yml</code></li>
</ul></li>
<li>Marina's file has all the data events&#x2026; How to get only the 4b CR events ? pinged her</li>
<li>Got instructions for CR events</li>
<li>skipping the input file for 4Tag events</li>
<li>fighting with trying to filter the 4b events</li>
</ul>
</div>
</div>

<div id="outline-container-org3babb3a" class="outline-3">
<h3 id="org3babb3a"><a href="../Journal/2025/03-March/31-March-2025-Monday.html#ID-EADAD6C4-B580-826C-56E7-4976DF7FAAA7">31 March 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org3babb3a">
<ul class="org-ul">
<li>Marina's cutflow is off
<ul class="org-ul">
<li>requested events/run list</li>
<li>[&gt;&gt;] Compare Events</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-org8a4c4f8" class="outline-3">
<h3 id="org8a4c4f8"><a href="../Journal/2025/03-March/17-March-2025-Monday.html#ID-06DD1AA5-DB7E-2E5D-E879-BF970A34A274">17 March 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org8a4c4f8">
<ul class="org-ul">
<li>added pt<sub>raw</sub> to debug output</li>
<li>remade pkl file for Marina&#x2026; sent</li>
</ul>
</div>
</div>

<div id="outline-container-org0c820c7" class="outline-3">
<h3 id="org0c820c7"><a href="../Journal/2025/03-March/14-March-2025-Friday.html#ID-7F40DCD3-868F-D0E9-37DF-A1D8CC4F8241">14 March 2025 Friday</a></h3>
<div class="outline-text-3" id="text-org0c820c7">
<ul class="org-ul">
<li>Fixed Cutflow for Marina</li>
<li>Add was only including one data Era</li>
<li>Add other eras</li>
<li>Add other Pt corrections</li>
<li>sent</li>
</ul>
</div>
</div>

<div id="outline-container-org44fa83f" class="outline-3">
<h3 id="org44fa83f"><a href="../Journal/2025/03-March/13-March-2025-Thursday.html#ID-8C72BE12-6828-6F0A-FB49-CA5817659A04">13 March 2025 Thursday</a></h3>
<div class="outline-text-3" id="text-org44fa83f">
<ul class="org-ul">
<li>Implementing Run3 Selection</li>
<li>Working cutflow &#x2026; got unit test working</li>
<li>Adding dhh min</li>
<li>Synch Higgs Candidate Selection</li>
<li>Making Cut flow for Marina:
<ul class="org-ul">
<li><code>python runner.py  -o synthetic_data_Run3_v8_debug_seedXXX.coffea -d data synthetic_data -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v8.yml</code></li>
</ul></li>
<li>Make output files for Marina
<ul class="org-ul">
<li><code>python analysis/debugRun3SyntheticData.py output/synthetic_dataset_analyze_all/synthetic_data_Run3_v8_debug_seedXXX.coffea</code></li>
</ul></li>
<li>Sent cutflow to Marina</li>
<li>Running plots for data vs synthetic</li>
</ul>
</div>
</div>

<div id="outline-container-org58bcbb2" class="outline-3">
<h3 id="org58bcbb2"><a href="../Journal/2025/03-March/12-March-2025-Wednesday.html#ID-2FBDF0DC-6722-A72F-18D5-1ED28CEAD64E">12 March 2025 Wednesday</a></h3>
<div class="outline-text-3" id="text-org58bcbb2">
<ul class="org-ul">
<li>Implementing Run3 selection</li>
<li>From Marina: 
<ul class="org-ul">
<li>Code: <a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/python/producers/hh4bTreeProducer.py?ref_type=heads</a></li>
<li>Config: <a href="https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/run/configs/2021/main/run3_2021_0L_PNet_MinDiag_Jets_4j35_2bj30_dHHjw30.yaml?ref_type=heads">https://gitlab.cern.ch/mkolosov/hh4b_run3/-/blob/run2/run/configs/2021/main/run3_2021_0L_PNet_MinDiag_Jets_4j35_2bj30_dHHjw30.yaml?ref_type=heads</a></li>
</ul></li>
<li>Synch Lepton Definition</li>
<li>[&gt;&gt;] Synch Higgs Candidate Selection</li>
<li>Synched Electrons</li>
<li>Synched Muons:</li>
<li>Testing with 
<ul class="org-ul">
<li><code>time python runner.py -t -o synthetic_data_Run3_2022_preEE.coffea -d data -p analysis/processors/processor_HH4b.py -y 2022_preEE   -op output/synthetic_dataset_analyze_all -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v6.yml</code></li>
</ul></li>
<li>Trying test case
<ul class="org-ul">
<li><code>python -m unittest analysis.tests.quadjet_test.quadJetTestCase</code></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org1a7fa4b" class="outline-3">
<h3 id="org1a7fa4b"><a href="../Journal/2025/01-January/07-January-2025-Tuesday.html#ID-55377750-457D-42C3-96AC-AF2D46D57488">7 January 2025 Tuesday</a></h3>
<div class="outline-text-3" id="text-org1a7fa4b">
<ul class="org-ul">
<li>output event list for florida
<ul class="org-ul">
<li><code>python debug_HHRun3.py</code></li>
</ul></li>
<li>Outputting our preSelection event list
<ul class="org-ul">
<li><code>time python runner.py -o data_Run3_2022_EE.coffea -d data -p analysis/processors/processor_HH4b.py -y 2022_EE   -op hists -c analysis/metadata/HH4b_run_fastTopReco.yml -m metadata/datasets_HH4b_Run3_fourTag_v4.yml</code></li>
</ul></li>
<li>Ask Marina to compare unblinded inclusive 4b counts&#x2026; Maybe normalization is CR acceptance difference</li>
<li>Made our event numbers list</li>
<li><code>python analysis/debugRun3CutFlow.py  hists/data_Run3_2022_EE.coffea</code></li>
<li>Only missing ~1% of events</li>
<li>Some differences in jet and b-jet multiplicities</li>
</ul>
</div>
</div>


<div id="outline-container-org24fcae9" class="outline-3">
<h3 id="org24fcae9"><a href="../Journal/2025/01-January/06-January-2025-Monday.html#ID-7F78110C-C72D-4DA4-92F9-333174E49D26">6 January 2025 Monday</a></h3>
<div class="outline-text-3" id="text-org24fcae9">
<ul class="org-ul">
<li>Copied File from marina to 
<code>root://cmseos.fnal.gov//store/user/jda102/debugRun3HH/data_2022_postEE_0_tree.root</code></li>
<li>Chat GPT to write uproot program</li>
<li>Wrote out a pkl file with the events and lumis</li>
<li>Make pickle of events passing 4jets selection</li>
</ul>
</div>
</div>
</div>
</div>
<div class="backlinks">
<h2>Backlinks</h2>
<ul>
  <li><a href="../Journal/2025/04-April/28-April-2025-Monday.html">28 April 2025 Monday</a></li>
</ul>
</div>
</body>
</html>
